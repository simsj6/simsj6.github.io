!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).animS={})}(this,function(e){"use strict";class v{constructor(e,t){this.x=e,this.y=t}}class g{constructor(e,t,s,i,n,r){this.x2=e,this.y2=t,this.x3=s,this.y3=i,this.x4=n,this.y4=r}}class M{constructor(e,t,s,i,n,r,h,a){this.x1=e,this.y1=t,this.x2=s,this.y2=i,this.x3=n,this.y3=r,this.x4=h,this.y4=a}static fromVetices(e,t){return new M(e.x,e.y,t.x2,t.y2,t.x3,t.y3,t.x4,t.y4)}}function b(e){return e instanceof v?new v(e.x,e.y):new v(e.x4,e.y4)}class i{constructor(e,t,s,i){if(t.length<=0)throw new Error("The vertex array must not be empty.");if(!(t[0]instanceof v))throw new Error("The start vertex must not be a Bezier vertex.");this.p5obj=e,this.vertices=t,this.startFrame=s,this.duration=i}update(){let e=(this.p5obj.frameCount-this.startFrame)/this.duration;1<(e=e<0?0:e)&&(e=1);var t,s,i,n,r,h,a,o,c,u,x,p,y=this.vertices.length-1,d=y*e,l=Math.floor(d),d=d-l;this.p5obj.beginShape(),this.p5obj.vertex(this.vertices[0].x,this.vertices[0].y);let f=b(this.vertices[0]);for(let e=0;e<l;e++){var w=this.vertices[e+1];w instanceof v?this.p5obj.vertex(w.x,w.y):this.p5obj.bezierVertex(w.x2,w.y2,w.x3,w.y3,w.x4,w.y4),f=b(w)}l<y&&((y=this.vertices[l+1])instanceof v?(t=f.x+(y.x-f.x)*d,i=f.y+(y.y-f.y)*d,this.p5obj.vertex(t,i)):(t=M.fromVetices(f,y),y=1-(i=0),n=1-d,r=(s=t).x1*y*y+2*s.x2*i*y+s.x3*i*i,h=s.x1*n*n+2*s.x2*d*n+s.x3*d*d,a=s.x2*y*y+2*s.x3*i*y+s.x4*i*i,o=s.x2*n*n+2*s.x3*d*n+s.x4*d*d,c=s.y1*y*y+2*s.y2*i*y+s.y3*i*i,u=s.y1*n*n+2*s.y2*d*n+s.y3*d*d,x=s.y2*y*y+2*s.y3*i*y+s.y4*i*i,s=s.y2*n*n+2*s.y3*d*n+s.y4*d*d,p=r*y+a*i,r=r*n+a*d,a=h*y+o*i,h=h*n+o*d,o=c*y+x*i,c=c*n+x*d,x=u*y+s*i,y=u*n+s*d,u=new M(p,o,r,c,a,x,h,y),this.p5obj.bezierVertex(u.x2,u.y2,u.x3,u.y3,u.x4,u.y4))),1<=e&&1<this.vertices.length&&this.vertices[this.vertices.length-1]instanceof v&&this.vertices[0].x==this.vertices[this.vertices.length-1].x&&this.vertices[0].y==this.vertices[this.vertices.length-1].y?this.p5obj.endShape(this.p5obj.CLOSE):this.p5obj.endShape()}}class t{constructor(e){this.p5obj=e||window,this.instances_=new Map,this.dedup_=new Set}getOrCreateShapeInstance_(e,t,s){if(this.checkDuplicateId_(e))throw new Error("AnimS id must not be duplicate in the same p5.js frame.");return this.instances_.has(e)?this.instances_.get(e):(t=new i(this.p5obj,t(),this.p5obj.frameCount,s),this.instances_.set(e,t),t)}checkDuplicateId_(e){e=e+"@"+this.p5obj.frameCount;return!!this.dedup_.has(e)||(this.dedup_.add(e),!1)}reset(){this.instances_.clear(),this.dedup_.clear()}arc(e,t,y,d,l,f,w,b){b<=w||b-w<1e-5||this.getOrCreateShapeInstance_(e,()=>{y-=.5*l,d-=.5*f,l=Math.abs(l),f=Math.abs(f);const s=l/2,i=f/2;y+=s,d+=i;for(var e,t,n,r,h,a,o,c,u,x=[];1e-5<=b-w;)e=Math.min(b-w,Math.PI/2),x.push((t=w,a=u=r=c=r=o=a=h=r=void 0,r=(n=e)/2,h=Math.cos(r),a=Math.sin(r),o=1/Math.tan(r),r=t+r,c=Math.cos(r),r=Math.sin(r),a+=(h-(u=(4-h)/3))*o,new M(Math.cos(t).toFixed(7),Math.sin(t).toFixed(7),(u*c+a*r).toFixed(7),(u*r-a*c).toFixed(7),(u*c-a*r).toFixed(7),(u*r+a*c).toFixed(7),Math.cos(t+n).toFixed(7),Math.sin(t+n).toFixed(7)))),w+=e;const p=[];return x.forEach((e,t)=>{0===t&&p.push(new v(y+e.x1*s,d+e.y1*i)),p.push(new g(y+e.x2*s,d+e.y2*i,y+e.x3*s,d+e.y3*i,y+e.x4*s,d+e.y4*i))}),p},t).update()}ellipse(e,t,h,a,o,c){this.getOrCreateShapeInstance_(e,()=>{h-=.5*o,a-=.5*c,o=Math.abs(o),c=Math.abs(c);var e=.5522847498,t=o/2*e,e=c/2*e,s=h+o,i=a+c,n=h+o/2,r=a+c/2;return[new v(h,r),new g(h,r-e,n-t,a,n,a),new g(n+t,a,s,r-e,s,r),new g(s,r+e,n+t,i,n,i),new g(n-t,i,h,r+e,h,r)]},t).update()}circle(e,t,s,i,n){n=Math.abs(n),this.ellipse(e,t,s,i,n,n)}line(e,t,s,i,n,r){this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r)],t).update()}quad(e,t,s,i,n,r,h,a,o,c){this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r),new v(h,a),new v(o,c),new v(s,i)],t).update()}rect(e,t,s,i,n,r){n=Math.abs(n),r=Math.abs(r),this.quad(e,t,s,i,s+n,i,s+n,i+r,s,i+r)}square(e,t,s,i,n){n=Math.abs(n),this.rect(e,t,s,i,n,n)}triangle(e,t,s,i,n,r,h,a){this.getOrCreateShapeInstance_(e,()=>[new v(s,i),new v(n,r),new v(h,a),new v(s,i)],t).update()}shape(e,t,s){this.getOrCreateShapeInstance_(e,()=>{var e=[];for(const t of s)if(2==t.length)e.push(new v(t[0],t[1]));else{if(6!=t.length)throw new Error("Only simple vertices (x, y) or Bezier vertices (x2, y2, x3, y3, x4, y4) are supported.");e.push(new g(t[0],t[1],t[2],t[3],t[4],t[5]))}return e},t).update()}}const u=new t;e.arc=function(e,t,s,i,n,r,h,a){u.arc(e,t,s,i,n,r,h,a)},e.circle=function(e,t,s,i,n){u.circle(e,t,s,i,n)},e.ellipse=function(e,t,s,i,n,r){u.ellipse(e,t,s,i,n,r)},e.line=function(e,t,s,i,n,r){u.line(e,t,s,i,n,r)},e.newAnimS=function(e){return new t(e)},e.quad=function(e,t,s,i,n,r,h,a,o,c){u.quad(e,t,s,i,n,r,h,a,o,c)},e.rect=function(e,t,s,i,n,r){u.rect(e,t,s,i,n,r)},e.reset=function(){u.reset()},e.shape=function(e,t,s){u.shape(e,t,s)},e.square=function(e,t,s,i,n){u.square(e,t,s,i,n)},e.triangle=function(e,t,s,i,n,r,h,a){u.triangle(e,t,s,i,n,r,h,a)},Object.defineProperty(e,"__esModule",{value:!0})});